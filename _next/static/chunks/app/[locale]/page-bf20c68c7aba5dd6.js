(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61],{91384:function(e,t,i){Promise.resolve().then(i.bind(i,34327)),Promise.resolve().then(i.bind(i,29900))},29900:function(e,t,i){"use strict";i.d(t,{default:function(){return v}});var a,o,n=i(57437),l=i(2265),r=i(63395),s=i(93999),u=i(93996),d=i(63874),c=i(29039);(a=o||(o={}))[a.Key=0]="Key",a[a.TransitCard=1]="TransitCard",a[a.CreditCard=2]="CreditCard",a[a.Phone=3]="Phone";var m=i(77744),p=i(5892),f=i(94648),g=l.memo(e=>{let t=(0,m.YP)(),i=l.useCallback(()=>{e.onPress&&e.onPress(e),null==t||t.panTo(new google.maps.LatLng(e.lat,e.lon))},[e,t]);return e.facility===u._.BIKE_STATION?(0,n.jsx)(p.Z,{onPress:i,...e}):(0,n.jsx)(f.Z,{onPress:i,...e})}),v=l.memo(()=>{let{queryParameters:e,setQueryParameters:t}=(0,d.q)(),i=function(){let e=(0,l.useRef)(!0);return!0===e.current?(e.current=!1,!0):e.current}(),{stations:a,waterFountains:o,lastUpdated:m,isLoading:p,refetch:f}=function(){let[e,t]=(0,l.useState)(!1),[i,a]=(0,l.useState)(new Date().getTime()),{onError:o}=(0,c.kY)(),{queryParameters:n}=(0,d.q)(),{error:r,data:s,isLoading:m,isValidating:p,mutate:f}=(0,c.ZP)({url:"/CityTrip/drinking-fountains.json",method:"GET"},{onError:()=>{}}),{error:g,data:v,isLoading:_,isValidating:y,mutate:C}=(0,c.ZP)({url:"https://tor.publicbikesystem.net/ube/gbfs/v1/en/station_information"},{onError:()=>{}}),{error:E,data:T,isLoading:b,isValidating:h,mutate:k}=(0,c.ZP)({url:"https://tor.publicbikesystem.net/ube/gbfs/v1/en/station_status"},{onError:()=>{}}),N=(0,l.useMemo)(()=>{var e;if(T&&(null==v?void 0:null===(e=v.data)||void 0===e?void 0:e.stations))return T.data.stations.map(e=>({...e,facility:u._.BIKE_STATION,rating:4,status:"IN_SERVICE"===e.status,status_text:e.status,...v.data.stations.find(t=>t.station_id===e.station_id)}))},[T,v]),I=(0,l.useMemo)(()=>{if(s&&(null==s?void 0:s.features))return s.features.map(e=>({station_id:e.properties.asset_id,name:e.properties.AssetName,lat:e.geometry.coordinates[0][1],lon:e.geometry.coordinates[0][0],address:e.properties.address,reason:e.properties.Reason,type:e.properties.type.split(",").map(e=>e.trim()),location:e.properties.location,location_details:e.properties.location_details,url:e.properties.url,rating:4,status:"1"===e.properties.Status,status_text:"1"===e.properties.Status?"IN_SERVICE":"CLOSED",facility:u._.WATER_FOUNTAIN}))},[s]),P=(0,l.useCallback)(async()=>{t(!1);let e=[];(null==n?void 0:n.facility.includes(u._.BIKE_STATION))&&(e.push(C()),e.push(k())),(null==n?void 0:n.facility.includes(u._.BIKE_STATION))||(C(void 0,{revalidate:!1}),k(void 0,{revalidate:!1})),(null==n?void 0:n.facility.includes(u._.WATER_FOUNTAIN))&&f(),(null==n?void 0:n.facility.includes(u._.WATER_FOUNTAIN))||f(void 0,{revalidate:!1}),await Promise.all(e),a(new Date().getTime())},[null==n?void 0:n.facility]);return(0,l.useEffect)(()=>{(g||E||r)&&!e&&(t(!0),o(g||E||r,"",{}))},[g,E,r]),{lastUpdated:i,stations:N,waterFountains:I,refetch:P,isLoading:b||_||m||y||h||p}}(),[v,_]=l.useState(void 0),[y,C]=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{timeout:1e4},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},[i,a]=(0,l.useState)({loading:null,accuracy:null,altitude:null,altitudeAccuracy:null,heading:null,latitude:null,longitude:null,speed:null,timestamp:null,error:null}),o=(0,l.useRef)(!1),n=(0,l.useRef)(e);return[i,(0,l.useCallback)(()=>{a(e=>({...e,loading:!0})),o.current=!1;let i=setTimeout(()=>{let e="Geolocation request timed out.";a(t=>({...t,loading:!1,error:Error(e)})),t(Error(e)),o.current=!0},e.timeout);navigator.geolocation.getCurrentPosition(e=>{let{coords:t,timestamp:o}=e;clearTimeout(i),a({loading:!1,timestamp:o,latitude:t.latitude,longitude:t.longitude,altitude:t.altitude,accuracy:t.accuracy,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,speed:t.speed,error:null})},e=>{clearTimeout(i),a(t=>({...t,loading:!1,error:e})),o.current||t(Error(e.message||"Geolocation failed due to an internal error."))},n.current)},[])]}({timeout:3500},e=>{s.Am.error(null==e?void 0:e.message)}),E=l.useMemo(()=>({lat:parseFloat("43.7292717"),lng:parseFloat("-79.6082231")}),[]),T=l.useMemo(()=>y.latitude&&y.longitude?{lat:y.latitude,lng:y.longitude}:void 0,[y.timestamp,y.latitude,y.longitude]);return l.useEffect(()=>{C()},[]),l.useEffect(()=>{i||f()},[e]),(0,n.jsxs)(r.b6,{onClick:()=>_(void 0),mapContainerClassName:"w-full h-full relative",zoom:13,defaultCenter:E,center:T,options:{backControl:!0,backControlOptions:{onClick:C,isLoading:(null==y?void 0:y.loading)||void 0},fullscreenControl:!1,streetViewControl:!1,zoomControl:!1,mapId:"ef34fc3265e9becb",mapTypeControl:!1,clickableIcons:!1},children:[(0,n.jsx)(r.lD,{className:"hidden md:flex",isLoading:p,lastUpdated:m,queryParameters:e,onSubmit:t}),[...o||[],...a||[]].map(e=>(0,l.createElement)(g,{...e,key:e.station_id,onPress:_,active:e.facility===(null==v?void 0:v.facility)&&e.station_id===(null==v?void 0:v.station_id)})),(0,n.jsx)(r.zC,{geolocation:y,visible:void 0!==v,marker:v,onCancel:()=>_(void 0)})]})})}},function(e){e.O(0,[910,990,373,970,39,15,49,827,971,23,744],function(){return e(e.s=91384)}),_N_E=e.O()}]);